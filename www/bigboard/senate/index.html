<!DOCTYPE html>
<html lang="en">
    <head>
        <title>House Race Big Board</title>
        <style>

        </style>
    </head>
    <body>
        <h1>Races</h1>
        <div id="candidates"></div>
        <!--[if lt IE 9]>
        <script src="js/lib/html5.js"></script>
        <![endif]-->

        <script type="text/javascript" src="../../js/lib/jquery-1.8.1.min.js"></script>
        <script type="text/javascript" src="../../js/lib/underscore-min.js"></script>
        <script type="text/javascript" src="../../js/lib/humanize.min.js"></script>
        <script type="text/javascript" src="../../bootstrap/js/bootstrap.js"></script>

        <script id="race-template" type="text/template">
            <% header = district.district.replace(' 0', ''); %>
            <h2><%= header %> <span class="precincts">100% reporting</span></h2>
            <ul><% _.each(district.candidates, function(candidate){ %>
                <% party_class = candidate.party.toLowerCase(); %>
                <% incumbent = ''; %>
                <% if (candidate.incumbent == 1) { incumbent = ' incumbent'; } %>
                <li class="<%= party_class %><%= incumbent %>">
                    <%= candidate.last_name %>, <%= candidate.first_name %>
                    (<%= candidate.party %>)
                    <% votes = Humanize.intcomma(candidate.vote_count); %>
                    <%= votes %>
                </li>
            <% }); %></ul>
        </script>

        <script type="text/javascript">
            function nukeTarget(target){ $(target).html(''); }

            $.getJSON('../../senate.json', function(districts) {

                nukeTarget('#candidates')
                var RACE_TEMPLATE = _.template($("#race-template").html());

                $.each(districts, function(index, district){
                    html = RACE_TEMPLATE({ district: district });
                    $('#candidates').append(html);
                });
            });
        </script>
    </body>
</html>