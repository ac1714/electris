{% extends "base.html" %}
{% block title %}Mark state winners{% endblock %}
{% block content %}
    <h1>Mark state winners</h1>

    <p>
    {% for state in states %}
    <a href="#{{ state.id }}">{{ state.name }}</a>{% if not loop.last %},{% endif %} 
    {% endfor %}
    </p>

    <form id="state-winners" method="POST">
        {% for state in states %}
        <div id="{{ state.id}}" class="control-group well">
            <h4>{{ state.name }}</h4>

            <h5>Predicted outcome</h5>

            {% for option in settings.PREDICTION_OPTIONS %}
            <label class="control-label radio inline">
                <input type="radio" name="prediction-{{ state.id }}" value="{{ option.0 }}" {% if state.prediction == option.0 %}checked="checked"{% endif %} />{{ option.1 }}
            </label>
            {% endfor %}

            <h5>AP call</h5>

            {% for option in settings.RESULT_OPTIONS %}
            <label class="control-label radio inline">
                <input type="radio" name="ap-{{ state.id }}" value="{{ option.0 }}" {% if state.ap_call == option.0 %}checked="checked"{% endif %} disabled="disabled"/>{{ option.1 }}
            </label>
            {% endfor %}

            <label class="control-label checkbox" style="margin-top: 5px;">
                <input type="checkbox" name="accept-ap-call-{{ state.id }}" {% if state.accept_ap_call == "y" %}checked="checked"{% endif %} /> Automatically publish AP call?
            </label>

            <h5>NPR call <small>(overrides AP call)</small></h5>

            {% for option in settings.RESULT_OPTIONS %}
            <label class="control-label radio inline">
                <input type="radio" name="npr-{{ state.id }}" value="{{ option.0 }}" {% if state.npr_call == option.0 %}checked="checked"{% endif %} />{{ option.1 }}
            </label>
            {% endfor %}

            <br />
            &nbsp;<br />
            <input type="submit" class="btn btn-primary" value="Save all" />&nbsp;
            <a href="#">Back to top</a><br />
        </div>
        {% endfor %}
    </form>
{% endblock %}

{% block extra_foot %}
<script type="text/javascript">
$(function() {
    function update_data() {     
        $.getJSON("/data", function(data) {
            $.each(data, function(i, state) {
                $(":radio[name=prediction-" + state.id + "][value=" + state.prediction + "]").attr("checked", true);
                $(":checkbox[name=accept-ap-call-" + state.id + "]").attr("checked", state.accept_ap_call == "y");
                $(":radio[name=npr-" + state.id + "][value=" + state.npr_call + "]").attr("checked", true);
            });

            console.log("Updated data from server.");
        });
    }

    setInterval(update_data, {{ settings.POLLING_INTERVAL }} * 1000);
});
</script>
{% endblock %}
